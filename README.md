# PHPVibe_vulnerability_Directory-Traversal
Description about PHPVibeCms' vulnerability
version:  11.0.3 ≤ 11.0.46
# Directory Traversal vulnerability

This **Directory Traversal** vulnerability was find in file **./app/uploading/upload-ffmpeg.php, ./app/uploading/upload-mp3.php and ./app/uploading/upload.php**. In these files, parameters from http requests are not strictly filtered, leading to the vulnerability.

The attacker can carefully construct a GET request packet containing a param ‘token’ and special headers, thus causing path traversal and writing files with the specified suffix to any web path.

The following file **'upload-ffmpeg.php'** is used as a replicated example, which shows the cause of the vulnerability and details of debugging the vulnerability.

Use the following poc to access **upload-ffmpeg.php**

![image](https://github.com/751897386/PHPVibe_vulnerability_Arbitrary-File-Write/assets/65012958/44bc7138-5a33-49a6-8ac8-60bb45a50097)


In the debug window, you can see that **$new_name** gets the full contents of the token.

![image](https://github.com/751897386/PHPVibe_vulnerability_Arbitrary-File-Write/assets/65012958/adf5e45c-5dda-4550-a40e-0aad6698603a)


The **$target_path** is by default, **$new_name** comes from **$token**, and **$ext** is the suffix of **$fileName**. Combining the first parameter of fopen, you can get the output path as follows.

![image](https://github.com/751897386/PHPVibe_vulnerability_Arbitrary-File-Write/assets/65012958/d085b482-af9a-47ed-978d-6fda3466292e)


Eventually, the file is written to .htaccess in the web root directory.

![image](https://github.com/751897386/PHPVibe_vulnerability_Arbitrary-File-Write/assets/65012958/63ca343d-06b1-4972-810d-264e240761e7)


We can see that the POST data is added at the end.

![image](https://github.com/751897386/PHPVibe_vulnerability_Arbitrary-File-Write/assets/65012958/b0bb8cc0-8f0a-417e-a819-1aa050d4da20)


Since cms uses .htaccess for Rewrite by default, writing .htaccess is absolutely valid!

Use the same logic to write the php code to the .png file.

![image](https://github.com/751897386/PHPVibe_vulnerability_Arbitrary-File-Write/assets/65012958/71aaff42-ab10-4df8-ba09-f5e8c682f275)

The .png file is parsed and executed.

![image](https://github.com/751897386/PHPVibe_vulnerability_Arbitrary-File-Write/assets/65012958/523a8b07-cd6e-4fc5-91cb-46fbe97113ab)

Fix: Blacklist file extension: .htaccess
